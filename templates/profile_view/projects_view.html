<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h3>Projects</h3>
    </div>
    <div class="card-body">
        {% if current_user.projects %}
            <div class="projects-list">
                {% set projects = [] %}
                {% if current_user.projects is string and current_user.projects.startswith('[') %}
                    {% try %}
                        {% set projects = current_user.projects | from_json %}
                    {% except %}
                        {% set projects = [{'name': 'Project parsing error', 'description': 'Unable to parse project data'}] %}
                    {% endtry %}
                {% else %}
                    {% set projects = current_user.projects %}
                {% endif %}
                
                {% for project in projects %}
                    <div class="project-item mb-4 p-3 border-bottom">
                        <div class="d-flex justify-content-between">
                            <h4>
                                {% if project.name %}{{ project.name }}{% endif %}
                                {% if project.dates %}<small class="text-muted">({{ project.dates }})</small>{% endif %}
                            </h4>
                            {% if project.link %}
                                <a href="{{ project.link }}" target="_blank" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-link-45deg"></i> View Project
                                </a>
                            {% endif %}
                        </div>
                        
                        <!-- Handle description as either a string or list -->
                        {% if project.description is defined %}
                            {% if project.description is string %}
                                <p class="description mb-2">{{ project.description }}</p>
                            {% else %}
                                <ul class="description mb-2">
                                    {% for desc in project.description %}
                                        <li>{{ desc }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        {% endif %}
                        
                        {% if project.technologies and project.technologies|length > 0 %}
                            <div class="technologies mb-2">
                                <strong>Technologies:</strong>
                                <div class="skills-tag-container">
                                    {% for tech in project.technologies %}
                                        <span class="badge bg-light text-dark">{{ tech }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if project.details and project.details|length > 0 %}
                            <div class="project-details mb-2">
                                <strong>Details:</strong>
                                <ul class="mb-0">
                                    {% for detail in project.details %}
                                        <li>{{ detail }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="empty-field">No projects added yet. Click 'Edit Profile' to add your projects.</p>
        {% endif %}
    </div>
</div>